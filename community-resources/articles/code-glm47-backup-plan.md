# 用 Code + GLM-4.7 做“断供备选”：海外模型/Agent 不可用时，你的 Plan B 应该长什么样？

关键词：glm-4.7, z.ai, openrouter, agent, mcp, lsp, skills, contingency plan

最近这半年，AI 编程工具圈子里反复发生同一种事故：**上游一收紧，你的工作流就断电**。

你以为你在用“一个模型”，但现实是你在依赖一整条链路：

- 某个海外模型（或某个订阅）
- 某个 OAuth / 鉴权方式
- 某个 Agent 客户端（IDE / CLI / 插件）
- 某个不可替代的默认配置

链路里任何一块变了，你的产能就会抖一下；如果变得更狠一点，就是“直接不可用”。

这篇文章讲一个更工程化的思路：**用 “Code + GLM-4.7” 搭一条可落地的备选路径**。不求它每次都比旗舰模型强，只求关键交付时**永远有路走**。

> 注：本文讨论“合规可控的替代方案与工程预案”，不鼓励任何绕过服务条款/逆向私有接口/伪造签名的做法。

参考来源（可引用）：

- GLM-4.7 官方 API 文档（Z.ai）：[docs.z.ai - Chat Completion](https://docs.z.ai/api-reference/llm/chat-completion)
- OpenCode 归档与迁移说明（背景案例）：[opencode-ai/opencode](https://github.com/opencode-ai/opencode)
- Crush README（体现“多模型/可插拔 provider + MCP + Skills”的方向）：[charmbracelet/crush](https://github.com/charmbracelet/crush)
- OpenRouter（GLM-4.7 Model ID：`z-ai/glm-4.7` 的公开列表）：[OpenRouter](https://openrouter.ai/)

## 1）先定义“备选”的目标：不是更强，是更稳

备选方案最常见的失败方式是：追求“同等体验”，结果复杂度更高、维护成本更大，最后还是没用上。

更靠谱的目标是三条：

- **可用**：随时能切换，30 分钟内跑通真实任务
- **可替换**：供应商/模型变了，不需要重写工作流
- **可迁移**：你的“能力资产”（提示词、工具、技能包、项目规约）能带走

GLM-4.7 的价值不在于它一定赢过某个海外旗舰，而在于：它给你提供了一条**“不依赖海外 OAuth/订阅链路也能跑”的路**。

## 2）“Code + GLM-4.7”里的 Code 指什么？

这里的 “Code” 不是某个品牌的唯一指代，你可以把它理解成：**能把 LLM 变成 coding agent 的客户端/壳**，只要它满足两点：

- 支持 **OpenAI 协议兼容**（可自定义 Base URL + API Key + model）
- 支持基本的 **工具调用/文件读写/命令执行**（让它真能改代码、跑测试）

为什么要强调“协议兼容”？因为这就是你的“插拔面”。当上游变化时，你改配置就能换模型，而不是换整套工具链。

## 3）GLM-4.7 的两条常见接入路径（建议都准备）

### 路径 A：直连 Z.ai（OpenAI 兼容风格）

Z.ai 的文档提供了 Chat Completions 形式的接口，你可以把它当作 OpenAI 兼容路线来接：

- Base URL（示例）：`https://api.z.ai/api/paas/v4`
- Path（示例）：`/chat/completions`
- 认证：`Authorization: Bearer <API_KEY>`
- 模型：`glm-4.7`

你真正要的不是“记住某个固定 URL”，而是把它变成你工具链里的**可配置项**。

### 路径 B：走聚合平台（比如 OpenRouter）

聚合平台的意义是“多一层路由与供应商冗余”，当你直连某家波动时，至少还有替代通道。

OpenRouter 上 GLM-4.7 常见的 Model ID 是：

`z-ai/glm-4.7`

（具体 Base URL / Header 写法以你工具支持的 OpenRouter 配置为准。）

## 4）一套真正能救命的“断供预案”应该怎么做？

很多人的 Plan B 只做到“能聊天”。但 AI 编程断供真正致命的是：**你的 agent 工作流断了**。

我更建议你按下面这 4 层去准备（从易到难、从关键到可选）：

### 第 1 层：模型可切换（最低要求）

- 同一个客户端里预置至少两条 provider：
  - 一条海外（你的主力）
  - 一条国内/替代（例如 GLM-4.7）
- 给每个项目留一份“可复制的配置片段”，让新人也能一键复现

### 第 2 层：工作流可降级（关键要求）

断供时你最需要的不是“把 UI 做得更炫”，而是把任务做完。

建议把任务拆成“可降级”的形态：

- **编码**：能改文件、能跑测试、能修错误
- **检索**：搜代码、读文档（必要时用 MCP / 内置搜索工具）
- **验收**：跑 lint/test/build，能根据输出继续修

当海外模型不可用时，GLM-4.7 能承担“把活做完”的角色；写作/创意/多模态可以后置或换别的模型补上。

### 第 3 层：能力资产可迁移（长期价值）

这也是本仓库最关心的点：**把能力沉淀成可移植资产**，而不是把经验锁死在某个闭源客户端里。

你可以把以下内容做成“随项目走”的资产：

- 项目规约（AGENTS.md / 贡献规范 / 测试命令）
- 可复用的提示词/命令模板
- 可复用的工具配置（MCP、LSP）
- 以及最重要的：**Agent Skills（Skill 文件夹 + `SKILL.md` + 脚本/资源）**

当你的工作流以 Skills 的形态存在时，换模型/换客户端的成本会显著降低。

### 第 4 层：供应链风险最小化（加分项）

更进一步，你可以做两件很“工程”的事：

- **避免依赖订阅 OAuth**：能用 API Key 的地方尽量用 API Key（合规、可控、可审计）
- **准备本地/自托管兜底**：哪怕性能差一点，也保证“最后还能跑”

## 5）一个可复制的“备选工作流”（建议你照着写进团队 wiki）

下面是一段你可以直接写进团队文档的 checklist（不绑定具体工具名）：

- **准备两条配置**：
  - Default：海外旗舰模型（主力）
  - Backup：GLM-4.7（直连 Z.ai 或 OpenRouter）
- **准备三条验证命令**（每个项目必须明确）：
  - `lint`
  - `test`
  - `build`（或最小可运行命令）
- **准备一个“最小任务演练”**（每周/每月跑一次）：
  - 让 agent 用 Backup 模型修一个小 bug 或补一个测试
  - 用 checklist 验收并记录耗时/失败点

Plan B 不演练，就等于没有。

## 6）结语：别把“断供”当新闻，把它当工程常识

AI 编程工具的上游变化会越来越频繁：条款、价格、速率限制、地区策略、OAuth 管控……都可能突然变化。

与其在断供时焦虑，不如提前把工具链做成“抗脆弱”：

- 主力用最强的
- 备选用最稳的
- 资产用可迁移的（Skills / 配置 / 规约）

当你把这些准备好，GLM-4.7 这类模型的意义就会非常清晰：它不一定是你最爱用的，但可能是你交付前夜最感谢的。

